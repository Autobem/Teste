"use strict";(self.webpackChunkBemMais2=self.webpackChunkBemMais2||[]).push([[3952],{3952:(oe,F,s)=>{s.r(F),s.d(F,{ProposalModule:()=>ee});var T=s(7751),f=s(9808),C=s(4521),r=s(3075),S=s(8966),d=s(97),t=s(5e3),B=s(1299);let j=(()=>{class n{constructor(){this.onInput=new t.vpe}ngOnInit(){}_onInput(e){this.onInput.emit(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-search-input"]],outputs:{onInput:"onInput"},decls:6,vars:0,consts:[[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text","bg-white","border-right-0"],["src","../../../../../../assets/icons/search.svg","alt",""],["type","search","placeholder","Buscar","matInput","",1,"form-control","border-left-0",3,"input"],["input",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._UZ(3,"img",3),t.qZA()(),t.TgZ(4,"input",4,5),t.NdJ("input",function(i){return o._onInput(i)}),t.qZA()())},styles:["input[type=search][_ngcontent-%COMP%]:active, input[type=search][_ngcontent-%COMP%]:focus{outline:0px!important;-webkit-appearance:none;box-shadow:none!important;border-color:#ced4da!important}"]}),n})();var b=s(6517);const V=["nameInput"],G=function(n,l,e){return{active:n,editing:l,done:e}};function W(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"li",32),t.NdJ("click",function(){const i=t.CHM(e).$implicit;return t.oxw().setActiveDriver(i)}),t._uU(1),t.ALo(2,"slice"),t.ALo(3,"titlecase"),t.qZA()}if(2&n){const e=l.$implicit,o=t.oxw();t.Q6J("ngClass",t.kEZ(8,G,(null==o.selectedDriver?null:o.selectedDriver.cnh)==e.cnh,(null==o.selectedDriver?null:o.selectedDriver.cnh)==e.cnh,(null==o.selectedDriver?null:o.selectedDriver.cnh)!==e.cnh)),t.xp6(1),t.hij(" ",e.name.length>20?t.Dn7(2,2,e.name,0,20)+"...":t.lcZ(3,6,e.name)," ")}}function X(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",33),t.NdJ("click",function(){return t.CHM(e),t.oxw().deleteDriver()}),t._uU(1," Excluir "),t.qZA()}}const K=function(){return{text:"Inserir dados"}},tt=function(){return{text:"Cadastro de motoristas"}},et=function(n,l){return[n,l]},ot=function(n){return{active:n}};let Q=(()=>{class n{constructor(e,o,a,i){this.fb=e,this.dialog=o,this.dialogRef=a,this.data=i,this.drivers=[],this.form=this.fb.group({name:["",[r.kI.required,r.kI.pattern(d.ZP.least2wordsPattern)]],cnh:["",[r.kI.required]]})}ngOnInit(){const e=JSON.parse(localStorage.getItem("drivers"));this.drivers=e||[],this.selectedDriver||setTimeout(()=>this.nameInput.nativeElement.focus(),100)}applyFilter(e){}setActiveDriver(e){this.selectedDriver=e,this.form.setValue(e),this.nameInput.nativeElement.focus()}addDriver(){this.selectedDriver&&this.form.reset({name:"",cnh:""}),this.selectedDriver={name:"Novo motorista"},setTimeout(()=>this.nameInput.nativeElement.focus(),100)}deleteDriver(){const e=this.drivers.filter(o=>o.cnh!==this.selectedDriver.cnh);this.drivers=[],this.drivers=[...e],localStorage.setItem("drivers",JSON.stringify(this.drivers)),this.form.reset({name:"",cnh:""}),this.selectedDriver={name:"Novo motorista"},this.nameInput.nativeElement.focus()}saveDriver(){if(!this.form.valid)return;const e=this.form.value,o=this.drivers.findIndex(a=>a.cnh==e.cnh);o>-1?this.drivers[o]=e:this.drivers.push(this.form.value),localStorage.setItem("drivers",JSON.stringify(this.drivers)),this.form.reset({name:"",cnh:""}),this.selectedDriver={name:"Novo motorista"},this.nameInput.nativeElement.focus()}closeModal(){this.dialogRef.close()}ngOnDestroy(){}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(r.qu),t.Y36(S.uw),t.Y36(S.so),t.Y36(S.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-driver-register"]],viewQuery:function(e,o){if(1&e&&t.Gf(V,5),2&e){let a;t.iGM(a=t.CRH())&&(o.nameInput=a.first)}},decls:45,vars:14,consts:[[1,"wrapper","px-0"],[1,"container"],[1,"d-flex","flex-column"],[3,"isModal","items","closeModal"],[1,"card","p-4","container-card"],[1,"d-flex","align-items-center","justify-content-between"],[1,"dropdown"],["type","button","id","driverFilter","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","btn-transparent","dropdown-toggle","dropdown-filter"],["aria-labelledby","driverFilter",1,"dropdown-menu"],[1,"dropdown-item"],[3,"onInput"],[1,"card","p-0","mt-3","inner-card"],[1,"row"],[1,"col-lg-3"],[1,"box","border-right","d-flex","driver-list"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"text-center","add-link",3,"ngClass","click"],[1,"fas","fa-plus"],[1,"col-lg"],[1,"box","d-flex","flex-column","justify-content-between"],[1,"my-3"],[3,"formGroup"],[1,"col-lg-9"],[1,"form-group"],["for","driver-name",1,"driver-name"],["type","text","name","","id","driver-name","formControlName","name",1,"form-control"],["nameInput",""],["for","driver-doc",1,"driver-doc"],["type","text","name","","id","driver-doc","formControlName","cnh",1,"form-control"],[1,"action-buttons","d-flex","align-items-center","justify-content-end"],["class","btn btn-outline-light-atb btn-lg",3,"click",4,"ngIf"],[1,"btn","btn-success-atb","btn-lg","ml-3",3,"click"],[3,"ngClass","click"],[1,"btn","btn-outline-light-atb","btn-lg",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-breadcrumb",3),t.NdJ("closeModal",function(){return o.dialogRef.close()}),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"button",7),t._uU(8," Todos "),t.qZA(),t.TgZ(9,"div",8)(10,"a",9),t._uU(11,"Todos"),t.qZA()()(),t.TgZ(12,"app-search-input",10),t.NdJ("onInput",function(i){return o.applyFilter(i)}),t.qZA()(),t.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"ul"),t.YNc(18,W,4,12,"li",15),t.TgZ(19,"li",16),t.NdJ("click",function(){return o.addDriver()}),t._UZ(20,"i",17),t._uU(21," Adicionar "),t.qZA()()()(),t.TgZ(22,"div",18)(23,"div",19)(24,"div")(25,"h4",20),t._uU(26),t.qZA(),t.TgZ(27,"form",21)(28,"div",12)(29,"div",22)(30,"div",23)(31,"label",24),t._uU(32,"Nome do motorista"),t.qZA(),t._UZ(33,"input",25,26),t.qZA()()(),t.TgZ(35,"div",12)(36,"div",22)(37,"div",23)(38,"label",27),t._uU(39,"CNH"),t.qZA(),t._UZ(40,"input",28),t.qZA()()()()(),t.TgZ(41,"div",29),t.YNc(42,X,2,0,"button",30),t.TgZ(43,"button",31),t.NdJ("click",function(){return o.saveDriver()}),t._uU(44," Salvar "),t.qZA()()()()()()()()()()),2&e){let a;t.xp6(3),t.Q6J("isModal",!0)("items",t.WLB(9,et,t.DdM(7,K),t.DdM(8,tt))),t.xp6(15),t.Q6J("ngForOf",o.drivers),t.xp6(1),t.Q6J("ngClass",t.VKq(12,ot,!(null!=o.selectedDriver&&o.selectedDriver.cnh))),t.xp6(7),t.hij(" ",""==(null==(a=o.form.get("name"))?null:a.value)?"Novo motorista":null==(a=o.form.get("name"))?null:a.value," "),t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(15),t.Q6J("ngIf",null==o.selectedDriver?null:o.selectedDriver.cnh)}},directives:[B.L,j,f.sg,f.mk,r._Y,r.JL,r.sg,b.MU,b.HK,r.Fj,b.oH,r.JJ,r.u,f.O5],pipes:[f.OU,f.rS],styles:['.mat-dialog-container{overflow:auto!important;padding:0}.wrapper[_ngcontent-%COMP%]{background-color:#f0f3f9;min-height:100vh;min-width:100vw;max-height:100vh;overflow-y:auto}  .cdk-overlay-pane{max-width:none!important}  .cdk-global-scrollblock{position:static;overflow:hidden!important}.container[_ngcontent-%COMP%]:first-child{padding:2rem 0}.card[_ngcontent-%COMP%]{padding:4.1rem 3.4rem}@media screen and (max-height: 800px){.container-card[_ngcontent-%COMP%]{max-height:630px}.inner-card[_ngcontent-%COMP%]{max-height:auto}.box[_ngcontent-%COMP%]{min-height:520px!important;max-height:520px!important}}.add-link[_ngcontent-%COMP%]{color:#0683f9;font-weight:700}.add-link[_ngcontent-%COMP%]:not(.active):hover{background:#e3f2fd}.box[_ngcontent-%COMP%]{padding:1rem;min-height:600px;max-height:600px;overflow:auto}.driver-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.driver-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .driver-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;padding:0;width:100%}.driver-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.5rem;width:100%;text-align:start;border-radius:4px;cursor:pointer;margin-bottom:5px}.driver-list[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#e3f2fd;color:#0683f9;font-weight:700}.driver-list[_ngcontent-%COMP%]   .editing[_ngcontent-%COMP%]:before{content:"\\f303";font-family:"Font Awesome 5 Free";display:inline-block;width:1.3em}.driver-list[_ngcontent-%COMP%]   li.done[_ngcontent-%COMP%]{color:#5cb85c;font-weight:700}.driver-list[_ngcontent-%COMP%]   li.done[_ngcontent-%COMP%]:before{content:"\\f058";font-family:"Font Awesome 5 Free";display:inline-block;width:1.3em}.driver-list[_ngcontent-%COMP%]   li.done[_ngcontent-%COMP%]:hover{background:#5cb85c19!important}']}),n})();var Y=s(312),Z=s(1135),nt=s(6367),at=s(5989),u=s(1639),it=s(4128),_=s(5698),y=s(8746),st=s(5764),x=s(3047),E=s(72),I=s(2290),rt=s(2953),lt=s(1772),O=s(1125),pt=s(3822),ct=s(6055);function dt(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"periodDataPipe"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij("",t.lcZ(2,1,e.dataPeriod)," dias ")}}function ut(n,l){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"periodDataPipe"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij("",t.lcZ(2,1,e.dataPeriod)," meses ")}}function mt(n,l){1&n&&(t.TgZ(0,"span"),t._uU(1," 1 m\xeas "),t.qZA())}const ht=function(){return{text:"Cota\xe7\xf5es"}},gt=function(){return{text:"Adicionar desconto "}},ft=function(n,l){return[n,l]};let vt=(()=>{class n{constructor(e,o,a,i,p,c){this.dialogRef=e,this.data=o,this.quotationService=a,this.loading=i,this.fb=p,this.toast=c,this.calculateTableBS$=new Z.X({}),this.firstTime=!0,this.totalProtectionValue=0,this.dataPeriod=0,this.form=this.fb.group({franchiseType:[{value:"",disabled:!0}],factor:[{value:0,disabled:!0}],coverageDays:[{value:0,disabled:!0}],discount:[0,[r.kI.required,(0,d.rJ)()]]})}ngOnInit(){this.loading.show(),(0,it.D)({assetList:this.quotationService.getQuotationFinalizationAssetsList(this.data.id,0,10),installments:this.quotationService.getProposalInstallments(this.data.id),finalization:this.quotationService.getQuotationFinalization(this.data.id)}).pipe((0,_.q)(1),(0,y.x)(()=>this.loading.hide())).subscribe(e=>{this.installment=e.installments,this.calculateTableBS$.next(e.assetList),this.firstTime=!1,this.dataPeriod=e.finalization.coverageDays/30,this.totalProtectionValue=e.finalization.totalProtectionValue,this.patchForm(e.finalization)})}patchForm(e){this.form.patchValue({franchiseType:st.f[e.franchiseType],factor:e.factor,coverageDays:e.coverageDays,discount:e.discount})}loadCalculateTable(e){!this.firstTime&&this.quotationService.getQuotationFinalizationAssetsList(this.data.id,e.skip,e.take).pipe((0,_.q)(1)).subscribe(o=>this.calculateTableBS$.next(o))}onSubmit(){var e;this.form.valid&&(this.loading.show(),this.quotationService.applyDiscount(this.data.id,{discountIndex:null===(e=this.form.get("discount"))||void 0===e?void 0:e.value}).pipe((0,_.q)(1),(0,y.x)(()=>this.loading.hide())).subscribe(o=>{this.toast.show("Disconto aplicado com sucesso!","",{toastClass:"success-toast"}),this.dialogRef.close()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(S.so),t.Y36(S.WI),t.Y36(x.G),t.Y36(E.t2),t.Y36(r.qu),t.Y36(I._W))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-proposal-discount"]],decls:50,vars:19,consts:[[1,"wrapper","px-0"],[1,"container"],[3,"isModal","items","closeModal"],[1,"card","card-content",2,"min-height","50vh"],[3,"formGroup","ngSubmit"],[1,"card-body","p-0","mb-5"],[1,"text-gray-500","mb-2"],[1,"card","flex-md-row","proposal-info","py-2","px-3","mb-3"],[1,"row"],[1,"form-group","col-md-3"],["for","participation",1,"subtitle-sm"],["type","text","formControlName","franchiseType",1,"form-control"],[1,"form-group","col-md-2"],["for","factor",1,"subtitle-sm"],["formControlName","factor"],[1,"form-group","col-md-4"],[1,"input-group"],["formControlName","coverageDays","type","text","aria-describedby","coverage-days","placeholder","180 dias",1,"form-control"],[1,"input-group-append"],["id","protection-time",1,"input-group-text","border-0"],[4,"ngIf"],[1,"form-group","col-md-3","col-lg-2"],["for","discount",1,"subtitle-sm"],["formControlName","discount"],[1,"border-custom-left","pl-md-3"],[1,"subtitle-sm"],[1,"text-blue-400"],[1,"card","p-2","mb-3"],[3,"quotationId","calculateTableBS$","loadCalculateTable$"],[1,"mat-elevation-z0","card"],["collapsedHeight","4.375rem",2,"font-weight","700"],[3,"installment","readOnly"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-light-atb","mr-3",3,"click"],["type","submit",1,"btn","btn-success-atb"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"app-breadcrumb",2),t.NdJ("closeModal",function(){return o.dialogRef.close()}),t.qZA(),t.TgZ(3,"div",3)(4,"form",4),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(5,"div",5)(6,"h3",6),t._uU(7," Cota\xe7\xe3o "),t.qZA(),t.TgZ(8,"div",7)(9,"div",8)(10,"div",9)(11,"label",10),t._uU(12," Participa\xe7\xe3o "),t.qZA(),t._UZ(13,"input",11),t.qZA(),t.TgZ(14,"div",12)(15,"label",13),t._uU(16,"Fator"),t.qZA(),t._UZ(17,"app-percent-input",14),t.qZA(),t.TgZ(18,"div",15)(19,"label",13),t._uU(20," Tempo de prote\xe7\xe3o "),t.qZA(),t.TgZ(21,"div",16),t._UZ(22,"input",17),t.TgZ(23,"div",18)(24,"span",19),t.YNc(25,dt,3,3,"span",20),t.YNc(26,ut,3,3,"span",20),t.YNc(27,mt,2,0,"span",20),t.qZA()()()(),t.TgZ(28,"div",21)(29,"label",22),t._uU(30,"Desconto"),t.qZA(),t._UZ(31,"app-percent-input",23),t.qZA()(),t.TgZ(32,"div",24)(33,"label",25),t._uU(34,"Valor do contrato"),t.qZA(),t.TgZ(35,"h2",26),t._uU(36),t.ALo(37,"currency"),t.qZA()()(),t.TgZ(38,"div",27)(39,"app-calculate-table",28),t.NdJ("loadCalculateTable$",function(i){return o.loadCalculateTable(i)}),t.qZA()(),t.TgZ(40,"mat-accordion")(41,"mat-expansion-panel",29)(42,"mat-expansion-panel-header",30),t._uU(43," Simula\xe7\xe3o de parcelamento "),t.qZA(),t._UZ(44,"app-installment-simulation-table",31),t.qZA()()(),t.TgZ(45,"div",32)(46,"button",33),t.NdJ("click",function(){return o.dialogRef.close()}),t._uU(47," Cancelar "),t.qZA(),t.TgZ(48,"button",34),t._uU(49,"Salvar"),t.qZA()()()()()()),2&e&&(t.xp6(2),t.Q6J("isModal",!0)("items",t.WLB(16,ft,t.DdM(14,ht),t.DdM(15,gt))),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(21),t.Q6J("ngIf",o.dataPeriod<1),t.xp6(1),t.Q6J("ngIf",o.dataPeriod>1),t.xp6(1),t.Q6J("ngIf",1==o.dataPeriod),t.xp6(9),t.Oqu(t.xi3(37,11,o.totalProtectionValue,"BRL")),t.xp6(3),t.Q6J("quotationId",null==o.data?null:o.data.id)("calculateTableBS$",o.calculateTableBS$),t.xp6(5),t.Q6J("installment",o.installment)("readOnly",!0))},directives:[B.L,r._Y,r.JL,r.sg,b.MU,b.HK,r.Fj,b.oH,r.JJ,r.u,rt.t,f.O5,lt.N,O.pp,O.ib,O.yz,pt.P],pipes:[ct.Y,f.H9],styles:[".mat-dialog-container{overflow:auto!important;padding:0}.wrapper[_ngcontent-%COMP%]{background-color:#f0f3f9;min-height:100vh;min-width:100vw;max-height:100vh;overflow-y:auto}  .cdk-overlay-pane{max-width:none!important}  .cdk-global-scrollblock{position:static;overflow:hidden!important}.container[_ngcontent-%COMP%]:first-child{padding:2rem 0}.card-content[_ngcontent-%COMP%]{justify-content:space-between;padding:3rem 1.25rem 2rem}@media screen and (min-width: 769px){.border-custom-left[_ngcontent-%COMP%]{border-left:1px solid #E5E5E5}}"]}),n})();var bt=s(1969),L=s(8080),A=s(7258),Ct=s(5214);function Pt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"a",17),t.NdJ("click",function(){const i=t.CHM(e).$implicit;return t.oxw().selectedProposalType=i}),t._uU(1),t.qZA()}if(2&n){const e=l.$implicit;t.xp6(1),t.Oqu(e)}}let St=(()=>{class n extends nt.K{constructor(e,o,a,i,p,c,v,m,h,P){super(),this.navbarService=e,this.router=o,this.route=a,this.quotationService=i,this.datePipe=p,this.commercialHelper=c,this.modal=v,this.dialog=m,this.toast=h,this.loading=P,this.categories=["Todas","Finalizadas","Em andamento"],this.proposals$=new Z.X({}),this.selectedProposalType=this.categories[0],this.displayedColumns=[{displayName:"Proposta",columnName:"number",className:"flex-15"},{displayName:"Status",columnName:"status",className:"flex-10",hasInnerHtml:!0,cell:({status:g})=>this.StatusTranslator[g]},{displayName:"Proponente",columnName:"proponent",hasInnerHtml:!0,cell:({proponent:g})=>`${g||""}`},{displayName:"Consultor",columnName:"socialBroker"},{displayName:"Data de cria\xe7\xe3o",columnName:"creation",className:"flex-15",hasInnerHtml:!0,cell:({creation:g})=>this.includeTooltip(this.convertDate(g),`${this.convertHour(g)}`)}],this.actions=[{iconClass:"fas fa-pen",eventName:"edit",tooltip:"Editar proposta"},{iconClass:"fas fa-file-alt",eventName:"document",tooltip:"Visualizar proposta"},{iconClass:"fas fa-ellipsis-v",isMenu:!0,tooltip:"Mais...",children:[{displayName:"Visualizar vistoria",eventName:"inspection"},{displayName:"Hist\xf3rico",eventName:"historic"},{displayName:"Baixar",eventName:"download"},{displayName:"Enviar por email",eventName:"email"},{displayName:"Adicionar desconto",eventName:"discount"},{displayName:"Cancelar",eventName:"delete"}]}],this.searchProposal=g=>this.searchTableItem(g,this.quotationService,this.loadTable,"quotationSearch",this.proposals$,"Nenhuma proposta gerada","Nenhuma proposta encontrada",["proposal"]),this.returnProponent=g=>g||"",this.navbarService.setContentTitle("Propostas")}get quotationServiceGetter(){return this.quotationService}get StatusTranslator(){return at.h}ngOnInit(){this.loadTable()}loadTable(e=0,o=10){this.initTable(this.quotationService,"quotationSearch","getQuotations",this.proposals$,e,o,"atb-search",["proposal"])}editProposal(e){this.router.navigate(["./",e.id,u.D[0]],{relativeTo:this.route})}deleteProposal(e){var o;const a=this.modal.open(Y.z,{centered:!0});a.componentInstance.list=["Deseja realmente cancelar a proposta?"],a.componentInstance.title="Cancelar proposta",a.componentInstance.type="alert",a.componentInstance.confirmButtonText="Sim",a.componentInstance.cancelButtonText="N\xe3o",null===(o=a.closed)||void 0===o||o.subscribe(i=>{!0===i&&(this.loading.show(),this.quotationService.cancelQuotation(e.id).pipe((0,y.x)(()=>this.loading.hide())).subscribe(()=>{this.toast.show("Proposta cancelada com sucesso","",{toastClass:"success-toast"}),this.loadTable(10*this.paginator.pageIndex,this.paginator.pageSize)}))})}openDiscountDialog(e){this.dialog.open(vt,{height:"100vh",width:"100vw",maxWidth:"none",data:e})}openViewQuotationHistoricDialog(e){this.dialog.open(bt.M,{height:"100vh",width:"100vw",maxWidth:"none",data:e})}permissionMessage(){this.toast.show("\xc9 necess\xe1rio efetuar o c\xe1lculo da proposta antes de executar esta a\xe7\xe3o","",{toastClass:"alert-toast"})}onAction(e){switch(e.action){case"edit":const o=a=>this.toast.show(`Proposta ${a}!`,"",{toastClass:"alert-toast"});"Expired"===e.element.status?o("expirada"):"Complete"===e.element.step?o("conclu\xedda"):this.editProposal(e.element);break;case"document":"Saved"===e.element.modification?this.commercialHelper.viewProposal(e.element.id).subscribe():this.permissionMessage();break;case"inspection":default:break;case"download":"Saved"===e.element.modification?this.commercialHelper.downloadProposalPdf(e.element.id).subscribe():this.permissionMessage();break;case"email":"Saved"===e.element.modification?this.commercialHelper.sendEmail(e.element.id).subscribe():this.permissionMessage();break;case"discount":"Saved"===e.element.modification?this.openDiscountDialog(e.element):this.permissionMessage();break;case"delete":this.deleteProposal(e.element);break;case"historic":this.openViewQuotationHistoricDialog(e.element)}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.I),t.Y36(C.F0),t.Y36(C.gz),t.Y36(x.G),t.Y36(f.uU),t.Y36(A.J),t.Y36(T.FF),t.Y36(S.uw),t.Y36(I._W),t.Y36(E.t2))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-list-proposals"]],features:[t.qOj],decls:21,vars:13,consts:[[1,"wrapper","px-0"],[1,"content-title"],[1,"card","table-card","mt-3"],[1,"w-100"],[1,"row","w-100","m-0"],[1,"col-lg-12"],[1,"table-header","pb-3","row","d-flex","align-items-center","justify-content-between"],[1,"col-4","col-lg-3"],[1,"dropdown","d-flex","align-items-center"],["type","button","id","dropdownMenuButton","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","btn-transparent","dropdown-toggle","category-dropdown","pl-0"],["aria-labelledby","dropdownMenuButton",1,"dropdown-menu"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"col-lg-3"],["src","../../../../../../assets/icons/search.svg","alt","",1,"search-icon"],["type","search","placeholder","Buscar","id","atb-search",1,"form-control","search-input",3,"ngbTypeahead"],["input",""],["emptyMessage","N\xe3o h\xe1 propostas criadas.",3,"dataSource","totalItems","columns","actions","spinner","indexColumn","onPaginator","page","action"],[1,"dropdown-item",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"span",1),t._uU(2,"Propostas criadas"),t.qZA(),t.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"button",9),t._uU(11),t.qZA(),t.TgZ(12,"div",10),t.YNc(13,Pt,2,1,"a",11),t.qZA()()(),t.TgZ(14,"div",12),t._UZ(15,"img",13)(16,"input",14,15),t.qZA()(),t.TgZ(18,"atb-table",16),t.NdJ("onPaginator",function(i){return o.paginator=i})("page",function(i){return o.loadTable(i.skip,i.take)})("action",function(i){return o.onAction(i)}),t.ALo(19,"async"),t.ALo(20,"async"),t.qZA()()()()()()),2&e){let a,i;t.xp6(11),t.hij(" ",o.selectedProposalType," "),t.xp6(2),t.Q6J("ngForOf",o.categories),t.xp6(3),t.Q6J("ngbTypeahead",o.searchProposal),t.xp6(2),t.Q6J("dataSource",null==(a=t.lcZ(19,9,o.proposals$))?null:a.items)("totalItems",null==(i=t.lcZ(20,11,o.proposals$))?null:i.total)("columns",o.displayedColumns)("actions",o.actions)("spinner",o.spinnerTable$)("indexColumn",!0)}},directives:[f.sg,T.dR,b.oH,Ct.a],pipes:[f.Ov],styles:[".table-card[_ngcontent-%COMP%]{padding:1rem 0}.table-container[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.1);margin-top:13px}i[_ngcontent-%COMP%]{cursor:pointer}mat-table[_ngcontent-%COMP%]{min-height:calc(100vh - 534px);overflow:auto}.input-group-prepend[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{height:40px}.mat-paginator-container[_ngcontent-%COMP%]{box-shadow:0 -12px 20px 12px #dbdbdb91}.mat-cell[_ngcontent-%COMP%], .mat-footer-cell[_ngcontent-%COMP%]{font-size:13px}.mat-cell[_ngcontent-%COMP%]:last-child, .mat-header-cell[_ngcontent-%COMP%]:last-child{max-width:104px}.dropdown-menu-table[_ngcontent-%COMP%]{position:absolute;right:15px}.dropdown-menu-table[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.form-control#category-select[_ngcontent-%COMP%]{font-weight:bolder;font-size:14px}.category-dropdown[_ngcontent-%COMP%]{font-weight:700}mat-row[_ngcontent-%COMP%]:hover{background-color:#0683f90d}mat-row[_ngcontent-%COMP%]:hover   .services-badge[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background:#3cc13b}.icon-row[_ngcontent-%COMP%]:hover{filter:brightness(.9)}a.action-link[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:12px}  .mat-sort-header-button{color:#0683f9!important;font-size:14px!important;font-weight:500}.badge[_ngcontent-%COMP%]{background:#0683f9;border-radius:4px;height:16px;width:16px;display:flex;align-items:center;justify-content:center;color:#fff}.w-10[_ngcontent-%COMP%]{flex:0 0 10%}.w-15[_ngcontent-%COMP%]{flex:0 0 15%}.asset-column[_ngcontent-%COMP%]{flex:0 0 25%}.index-column[_ngcontent-%COMP%]{flex:0 0 5%;font-weight:700}.icon-column[_ngcontent-%COMP%]{flex:0 0 5%}.mat-cell[_ngcontent-%COMP%], .mat-footer-cell[_ngcontent-%COMP%]{font-size:14px}.icon-edit[_ngcontent-%COMP%]{background:url(edit-gray-200.846986be6785e7d9.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block;margin-right:15px}.mat-row[_ngcontent-%COMP%]:hover   .icon-edit[_ngcontent-%COMP%]{background:url(edit-gray-600.38c3a20f7c11f612.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block;margin-right:15px}.icon-delete[_ngcontent-%COMP%]{background:url(trash-gray-200.3eb8d4bb5574879f.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block;margin-right:22px}.mat-row[_ngcontent-%COMP%]:hover   .icon-delete[_ngcontent-%COMP%]{background:url(trash-gray-600.69d9d1b764947c63.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block;margin-right:22px}.icon-menu[_ngcontent-%COMP%]{background:url(menu-gray-200.5fa78952b2457241.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block}.mat-row[_ngcontent-%COMP%]:hover   .icon-menu[_ngcontent-%COMP%]{background:url(menu-gray-600.c0ca7431cca3ba9e.svg) no-repeat;background-size:contain;width:18px;height:18px;display:block}@media screen and (min-width: 1650px){mat-table[_ngcontent-%COMP%]{min-height:calc(100vh - 32.6rem)}}@media screen and (max-height: 850px){mat-table[_ngcontent-%COMP%]{min-height:calc(100vh - 470px)}.asset-column[_ngcontent-%COMP%]{flex:0 0 20%}}"]}),n})();var w=s(8306),_t=s(1094),yt=s(2498),M=s(9646),Tt=s(8505),xt=s(1884),It=s(1520),H=s(2569),Mt=s(1470),Zt=s(9369),Ot=s(3915),At=s(1644);function wt(n,l){1&n&&t._UZ(0,"input",20)}function Nt(n,l){1&n&&t._UZ(0,"input",21)}function Dt(n,l){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"span",2),t._uU(3,"Inserir os dados do proponente"),t.qZA(),t.TgZ(4,"div",3)(5,"div",4),t._UZ(6,"br"),t.TgZ(7,"div",5)(8,"h4"),t._uU(9,"Dados pessoais"),t.qZA()(),t._UZ(10,"br"),t.TgZ(11,"form",6)(12,"div",7)(13,"div",8)(14,"label",9),t._uU(15),t.qZA(),t.YNc(16,wt,1,0,"input",10),t.YNc(17,Nt,1,0,"input",11),t.qZA(),t.TgZ(18,"div",12)(19,"label",13),t._uU(20),t.qZA(),t._UZ(21,"input",14),t.qZA()(),t._UZ(22,"app-personal-data-form",15)(23,"br"),t.TgZ(24,"div",5)(25,"h4"),t._uU(26,"Contato"),t.qZA()(),t._UZ(27,"br")(28,"app-contact-form",7)(29,"app-address-form",16),t.qZA()()(),t.TgZ(30,"div",17)(31,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAction(!1)}),t._uU(32," Voltar "),t.qZA(),t.TgZ(33,"button",19),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSubmit()}),t._uU(34," Pr\xf3ximo "),t.qZA()()(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(11),t.Q6J("formGroup",e.form),t.xp6(4),t.hij(" ","Natural"==e.personType?"CPF/CNPJ":"CNPJ"," "),t.xp6(1),t.Q6J("ngIf","Natural"==e.personType),t.xp6(1),t.Q6J("ngIf","Legal"==e.personType),t.xp6(3),t.hij(" ","Natural"==e.personType?"Nome":"Raz\xe3o Social"," "),t.xp6(1),t.Q6J("maxlength",300),t.xp6(1),t.Q6J("static$",e.static$)("personType",e.personType),t.xp6(7),t.Q6J("static$",e.static$)}}let R=(()=>{class n extends yt.o{constructor(e,o,a,i,p,c,v,m){super(v,m),this.dialog=e,this.quotationService=o,this.route=a,this.router=i,this.toastr=p,this.loading=c,this.injector=v,this.modalService=m,this.quotationId="",this.proponent={},this.personType="Natural",this.showStep=!1,this.isLocked=!1,this.static$=new w.y,this.stepAction=new t.vpe,this.formSubmitted=new t.vpe,this.hideLoading=()=>this.loading.hide()}set _showStep(e){var o,a;this.showStep=e,this.showStep&&(this.buildForm(),this.onFederationUnit(),this.loading.show(),this.quotationService.getProponentStatic().pipe((0,_.q)(1),(0,Tt.b)(i=>this.static$=(0,M.of)(i))).subscribe(),this.quotationId=null===(a=null===(o=this.route)||void 0===o?void 0:o.parent)||void 0===a?void 0:a.snapshot.paramMap.get("id"),this.patchValueForm())}ngOnInit(){}disableComponents(){1==this.form.value.isLocked&&this.form.disable()}get naturalForm(){return this.form.get("natural")}buildForm(){this.form=this.formBuilder.group({id:[null],document:[null,[r.kI.required,(0,d.B5)()]],displayName:[null,[r.kI.required,(0,d.fM)()]],personType:[null,[r.kI.required]],isLocked:[this.isLocked],acceptChangeFederationUnit:[!1],natural:this.formBuilder.group({birthdate:[null,[r.kI.required]],generalRegistry:[null,[r.kI.required]],issuingAgency:[null,[r.kI.required,(0,d.b$)()]],cnh:[null,[r.kI.required]],nationality:[null,[r.kI.required,(0,d.C$)()]],naturalness:[null,[r.kI.required,(0,d.C$)()]],gender:[null,[r.kI.required]],maritalStatus:[null,[r.kI.required]],fatherName:[null,[(0,d.fM)()]],motherName:[null,[r.kI.required,(0,d.fM)()]],dependentsCount:[0,[r.kI.required,(0,d.mD)()]]}),legal:this.formBuilder.group({stateRegistration:[null,[r.kI.required]],foundationDate:[null,[r.kI.required]],fantasyName:[null,[r.kI.required]],administratorName:[null,[r.kI.required,(0,d.kr)()]],administratorDocument:[null,[r.kI.required]]}),contacts:this.formBuilder.array([this.formBuilder.group({id:[],types:[["Mobile"]],contact:["",[r.kI.required,(0,d.tH)()]],description:["Mobile1"]}),this.formBuilder.group({id:[],types:[["Phone"]],contact:["",[(0,d.tH)()]],description:["Phone1"]}),this.formBuilder.group({id:[],types:[["Email"]],contact:["",[r.kI.required,(0,d.Le)()]],description:["Email1"]})]),addresses:this.formBuilder.array([this.formBuilder.group({id:[],clientId:[null],description:["main"],streetName:[null,[r.kI.required,(0,d.Bp)()]],number:[null,[r.kI.required,(0,d.rE)()]],complement:[null,[(0,d.Bp)()]],neighborhood:[null,[r.kI.required,(0,d.Bp)()]],city:[null,[r.kI.required,(0,d.C$)()]],federationUnit:[null,[r.kI.required]],zipCode:[null,[r.kI.required]],latitude:[null],longitude:[null]})])})}patchValueForm(){this.quotationService.getProponent(this.quotationId).pipe((0,_.q)(1),(0,y.x)(()=>{this.loading.hide()})).subscribe(e=>{var o,a,i,p,c,v,m,h,P,g,N,D,k,q,J,U,$,z;this.personType=e.personType,this.proponent=e,console.log(e),this.form.patchValue({id:e.id,document:e.document,displayName:e.displayName,personType:e.personType,isLocked:e.isLocked,contacts:this.patchArrayContacts(e.contacts),address:this.patchArrayAddresses(e.addresses,e.federationUnit)}),this.isLocked=this.form.value.isLocked,e.natural&&(null===(o=this.form.get("natural"))||void 0===o||o.patchValue({generalRegistry:(null===(a=e.natural)||void 0===a?void 0:a.generalRegistry)||null,birthdate:new Date(null===(i=e.natural)||void 0===i?void 0:i.birthdate).toISOString().split("T")[0]||null,issuingAgency:(null===(p=e.natural)||void 0===p?void 0:p.issuingAgency)||null,cnh:(null===(c=e.natural)||void 0===c?void 0:c.cnh)||null,nationality:(null===(v=e.natural)||void 0===v?void 0:v.nationality)||null,naturalness:(null===(m=e.natural)||void 0===m?void 0:m.naturalness)||null,gender:(null===(h=e.natural)||void 0===h?void 0:h.gender)||null,maritalStatus:(null===(P=e.natural)||void 0===P?void 0:P.maritalStatus)||null,fatherName:(null===(g=e.natural)||void 0===g?void 0:g.fatherName)||null,motherName:(null===(N=e.natural)||void 0===N?void 0:N.motherName)||null,dependentsCount:(null===(D=e.natural)||void 0===D?void 0:D.dependentsCount)||0})),e.legal&&(null===(k=this.form.get("legal"))||void 0===k||k.patchValue({stateRegistration:(null===(q=e.legal)||void 0===q?void 0:q.stateRegistration)||null,foundationDate:new Date(null===(J=e.legal)||void 0===J?void 0:J.foundationDate).toISOString().split("T")[0]||null,administratorName:(null===(U=e.legal)||void 0===U?void 0:U.administratorName)||null,fantasyName:(null===($=e.legal)||void 0===$?void 0:$.fantasyName)||null,administratorDocument:(null===(z=e.legal)||void 0===z?void 0:z.administratorDocument)||null})),this.form.removeControl("Natural"==e.personType?"legal":"natural"),this.disableComponents()})}onFederationUnit(){var e;const o=this.form.get("addresses").controls[0];null===(e=o.get("federationUnit"))||void 0===e||e.valueChanges.pipe((0,xt.x)(),(0,It.G)()).subscribe(([a,i])=>{var p,c;const v=(m,h=!0)=>{var P;null===(P=o.get("federationUnit"))||void 0===P||P.setValue(m,{onlySelf:h,emitEvent:h})};i!==this.proponent.federationUnit?(null===(p=this.form.get("acceptChangeFederationUnit"))||void 0===p?void 0:p.value)||(v(a),this.openChangeFederationUnitModal().subscribe(m=>{var h;null===(h=this.form.get("acceptChangeFederationUnit"))||void 0===h||h.setValue(!!m),m&&v(i,!1)})):null===(c=this.form.get("acceptChangeFederationUnit"))||void 0===c||c.setValue(!1)})}openChangeFederationUnitModal(){const e=this.modalService.open(Y.z,{centered:!0});return e.componentInstance.title="Mudan\xe7a de federa\xe7\xe3o",e.componentInstance.type="alert",e.componentInstance.confirmButtonText="Sim",e.componentInstance.cancelButtonText="N\xe3o",e.componentInstance.list=["Essa altera\xe7\xe3o de Estado (UF) ir\xe1 remover os servi\xe7os de todos os bens. Voc\xea deseja continuar?"],e.closed}onOpenDriverRegister(){this.dialog.open(Q,{height:"100vh",width:"100vw",maxWidth:"none",disableClose:!0,closeOnNavigation:!0})}onAction(e){e?this.stepAction.emit({goForward:e}):this.router.navigate(["../../app/comercial/proposta"])}onSubmit(e){if(this.form.valid||"DISABLED"===this.form.status){if(this.form.dirty){this.loading.show();const o=Object.assign({},this.form.value);return o.contacts=o.contacts.filter(a=>""!=a.contact),e?this.quotationService.updateProponent(this.quotationId,o).pipe((0,_.q)(1)):(this.quotationService.updateProponent(this.quotationId,o).pipe((0,_.q)(1)).subscribe(a=>{this.toastr.show("Proponente atualizado com sucesso!","title",{toastClass:"success-toast"}),this.loading.hide(),this.stepAction.emit({direction:"forward"})}),(0,M.of)())}return(0,M.of)(!!e||this.stepAction.emit({direction:"forward"}))}return this.form.markAllAsTouched(),this.markAllAsDirty(this.form),this.toastr.show("Formul\xe1rio inv\xe1lido! Verifique os campos e tente novamente!","title",{toastClass:"error-toast"}),(0,M.of)(!1)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(S.uw),t.Y36(x.G),t.Y36(C.gz),t.Y36(C.F0),t.Y36(I._W),t.Y36(H.b),t.Y36(t.zs3),t.Y36(T.FF))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-proponent-proposal"]],inputs:{_showStep:["showStep","_showStep"]},outputs:{stepAction:"stepAction",formSubmitted:"formSubmitted"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"wrapper","container-fluid","px-0"],[1,"content-title","mb-3"],[1,"card","card-form"],[1,"d-flex","flex-column"],[1,"title","contact"],[3,"formGroup"],[1,"row"],[1,"form-group","col-lg-4"],["for","cpf",1,"required"],["mask","000.000.000-00||00.000.000/0000-00","formControlName","document","type","text","class","form-control","id","cpf","placeholder","",4,"ngIf"],["mask","00.000.000/0000-00","formControlName","document","type","text","class","form-control","id","cpf","placeholder","",4,"ngIf"],[1,"form-group","col-lg-8"],["for","displayName",1,"required"],["formControlName","displayName","type","text","id","displayName","placeholder","","value","",1,"form-control",3,"maxlength"],[3,"static$","personType"],[3,"static$"],[1,"buttons"],[1,"btn","btn-outline-light-atb","btn-lg",3,"click"],["type","submit","form","proponent-form",1,"btn","btn-primary","btn-lg",3,"click"],["mask","000.000.000-00||00.000.000/0000-00","formControlName","document","type","text","id","cpf","placeholder","",1,"form-control"],["mask","00.000.000/0000-00","formControlName","document","type","text","id","cpf","placeholder","",1,"form-control"]],template:function(e,o){1&e&&t.YNc(0,Dt,35,9,"ng-container",0),2&e&&t.Q6J("ngIf",o.showStep)},directives:[f.O5,r._Y,r.JL,r.sg,b.MU,b.HK,Mt.hx,r.Fj,b.oH,r.JJ,r.u,r.nD,Zt.z,Ot.p,At.C],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.proponent-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-evenly;width:50%;max-width:500px}@media screen and (max-width: 768px){.proponent-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;max-width:auto}}.card-form[_ngcontent-%COMP%]{padding:2rem 2.25rem 5rem}.card-dados[_ngcontent-%COMP%]{border:1px solid #E7E7E7;padding:5px}.driver-card[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;min-height:120px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.buttons[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;justify-content:space-between}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:156px}"]}),n})();var kt=s(2178),qt=s(8004),Jt=s(9694),Ut=s(2071);let $t=(()=>{class n{constructor(e,o,a,i,p,c,v){var m,h;this.router=e,this.navBarService=o,this.commercialHelper=a,this.quotationService=i,this.loading=p,this.route=c,this.toastr=v,this.currentStep=u.q.Proponent,this.assets=[],this.allowFinalize=!1,this.proposal$=new Z.X(null),this.participation$=new w.y,this.statics$=new w.y,this.steps=[{index:u.q.Proponent,label:"Proponente"},{index:u.q.Assets,label:"Bens cadastrados"},{index:u.q.Finalize,label:"Calcular proposta"},{index:u.q.Acceptance,label:"Finalizar"}],this.proposalId=null===(h=null===(m=this.route)||void 0===m?void 0:m.parent)||void 0===h?void 0:h.snapshot.paramMap.get("id"),this.navBarService.setContentTitle("Propostas"),this.commercialHelper.setContentTitle(this.proposalId,this.proposal$),this.currentStep=Number(u.D[this.route.snapshot.paramMap.get("step")])||0}get ProposalSteps(){return u.q}get assetsTableBS$(){return this.commercialHelper.assetsTableBS$}get calculateTableBS$(){return this.commercialHelper.calculateTableBS$}get installment$(){return this.commercialHelper.installment$}get calculatePanelData$(){return this.commercialHelper.getQuotationFinalizationData(this.proposalId)}get calculateEvents$(){return this.commercialHelper.calculateEvents$}ngOnInit(){this.assets=null==JSON.parse(localStorage.getItem("assets"))?[]:JSON.parse(localStorage.getItem("assets"))}setStep(e){this.statics$=this.quotationService.getQuotationStatics(),this.loadCalculationTable(this.proposalId,0,10),this.participation$=this.commercialHelper.getQuotationParticipationData(this.proposalId)}changeStep(e){const a=JSON.parse(sessionStorage.getItem(`proposalStep-${this.proposalId}`))||null,i=p=>sessionStorage.setItem(`proposalStep-${this.proposalId}`,JSON.stringify({step:p||e.clickedStep||this.currentStep,finalized:(null==a?void 0:a.finalized)||!1}));if(e.clickedStep+1>0)switch(e.clickedStep){case u.q.Proponent:this.currentStep=e.clickedStep,i(),this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route});break;case u.q.Acceptance:JSON.parse(sessionStorage.getItem(`proposalStep-${this.proposalId}`)).finalized&&(this.currentStep=e.clickedStep,i(),this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route}));break;default:this.currentStep==u.q.Proponent?this.proponentProposalComponent.onSubmit(!0).subscribe(c=>{"object"==typeof c&&(this.toastr.show("Proponente atualizado com sucesso!","title",{toastClass:"success-toast"}),this.proponentProposalComponent.hideLoading()),c&&(this.currentStep=e.clickedStep,this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route}),i())}):(this.currentStep=e.clickedStep,this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route}),i())}else"forward"==e.direction?(++this.currentStep,this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route}),i()):(this.currentStep==u.q.Proponent?!this.router.navigate(["../../app/comercial/proposta"])&&i(0):this.currentStep--,this.router.navigate(["../",u.D[this.currentStep]],{relativeTo:this.route}),i())}updateInstallments(e){this.loading.show(),this.quotationService.updateProposalInstallments(this.proposalId,e).pipe((0,_.q)(1),(0,y.x)(()=>this.loading.hide())).subscribe(()=>this.toastr.show("Parcelamento atualizado.","title",{toastClass:"success-toast"}))}loadAssetsTable(e=this.proposalId,o=0,a=10){this.commercialHelper.loadAssetsRegisterTable(e,o,a).subscribe()}saveProponent(e){this.proponent=e,localStorage.setItem("proponent",JSON.stringify(e))}saveAsset(e){e.services=[],this.assets=[...this.assets,e],localStorage.setItem("assets",JSON.stringify(this.assets))}deleteAsset(e){if(e.serialNumber)return this.assets=this.assets.filter(o=>o.serialNumber!==e.serialNumber),void localStorage.setItem("assets",JSON.stringify(this.assets));this.assets=this.assets.filter(o=>o.licensePlate!==e.licensePlate),localStorage.setItem("assets",JSON.stringify(this.assets))}loadCalculationTable(e=this.proposalId,o=0,a=10){this.commercialHelper.loadFinalizationTable(e,o,a).subscribe()}calculateQuotation(e){this.commercialHelper.calculateQuotation(e,this.proposalId).subscribe()}finalizeProposal(){const e=JSON.parse(sessionStorage.getItem(`proposalStep-${this.proposalId}`));e.finalized?this.changeStep({direction:"forward"}):this.commercialHelper.finalizeProposal(this.proposalId).subscribe(o=>{e.finalized=!0,sessionStorage.setItem(`proposalStep-${this.proposalId}`,JSON.stringify(e)),this.changeStep({direction:"forward"})})}editAsset(e){}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.F0),t.Y36(L.I),t.Y36(A.J),t.Y36(x.G),t.Y36(H.b),t.Y36(C.gz),t.Y36(I._W))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-proposal-steps"]],viewQuery:function(e,o){if(1&e&&t.Gf(R,5),2&e){let a;t.iGM(a=t.CRH())&&(o.proponentProposalComponent=a.first)}},features:[t._Bn([A.J])],decls:9,vars:27,consts:[[3,"steps","currentStep","stepClicked"],[3,"showStep","stepAction"],[3,"showStep","assetsTableBS$","isQuotation","loadAssetsTable$","stepAction"],[3,"showStep","statics$","calculateTableBS$","calculateEvents","participation$","proposal","installment","calculatePanelData$","isQuotation","calculate","updateInstallments","loadCalculateTable$","finalize","stepAction","setStep"],[3,"showStep","isProposal"]],template:function(e,o){1&e&&(t.TgZ(0,"div")(1,"app-stepper",0),t.NdJ("stepClicked",function(i){return o.changeStep(i)}),t.qZA(),t.TgZ(2,"app-proponent-proposal",1),t.NdJ("stepAction",function(i){return o.changeStep(i)}),t.qZA(),t.TgZ(3,"app-assets-register",2),t.NdJ("loadAssetsTable$",function(){return o.loadAssetsTable()})("stepAction",function(i){return o.changeStep(i)}),t.qZA(),t.TgZ(4,"app-proposal-finalize",3),t.NdJ("calculate",function(i){return o.calculateQuotation(i)})("updateInstallments",function(i){return o.updateInstallments(i)})("loadCalculateTable$",function(i){return o.loadCalculationTable(o.proposalId,null==i?null:i.skip,null==i?null:i.take)})("finalize",function(){return o.finalizeProposal()})("stepAction",function(i){return o.changeStep(i)})("setStep",function(i){return o.setStep(i)}),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA(),t._UZ(8,"app-finalize-quotation",4),t.qZA()),2&e&&(t.xp6(1),t.Q6J("steps",o.steps)("currentStep",o.currentStep),t.xp6(1),t.Q6J("@fadeInAnim",o.currentStep===o.ProposalSteps.Proponent)("showStep",o.currentStep===o.ProposalSteps.Proponent),t.xp6(1),t.Q6J("@fadeInAnim",o.currentStep===o.ProposalSteps.Assets)("showStep",o.currentStep===o.ProposalSteps.Assets)("assetsTableBS$",o.assetsTableBS$)("isQuotation",!1),t.xp6(1),t.Q6J("@fadeInAnim",o.currentStep===o.ProposalSteps.Finalize)("showStep",o.currentStep===o.ProposalSteps.Finalize)("statics$",o.statics$)("calculateTableBS$",o.calculateTableBS$)("calculateEvents",t.lcZ(5,21,o.calculateEvents$))("participation$",o.participation$)("proposal",t.lcZ(6,23,o.proposal$))("installment",t.lcZ(7,25,o.installment$))("calculatePanelData$",o.calculatePanelData$)("isQuotation",!1),t.xp6(4),t.Q6J("@fadeInAnim",o.currentStep===o.ProposalSteps.Acceptance)("showStep",o.currentStep===o.ProposalSteps.Acceptance)("isProposal",!0))},directives:[kt.v,R,qt.P,Jt.Q,Ut.E],pipes:[f.Ov],styles:[""],data:{animation:[_t.Gs]}}),n})();var zt=s(6539);const Ft=[{path:"",component:St},{path:":id",data:{title:"Criar Proposta"},component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-proposal"]],decls:1,vars:0,template:function(e,o){1&e&&t._UZ(0,"router-outlet")},directives:[C.lC],styles:[""]}),n})(),children:[{path:":step",component:$t}]},{path:":id/motoristas",component:Q},{path:":id/questionario",component:zt.v}];let Bt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[C.Bz.forChild(Ft)],C.Bz]}),n})();var Qt=s(7622),Yt=s(8279),Et=s(7446),Lt=s(6087),Ht=s(4847),Rt=s(645),jt=s(1170),Vt=s(6154),Gt=s(1660),Wt=s(664),Xt=s(7335),Kt=s(3421),te=s(7496);let ee=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.ez,Bt,Qt.m,Kt.T,Rt.b,jt.s,Vt.Z,Gt.e,Yt.p0,Et.p9,Lt.TU,Ht.JX,S.Is,T.ZS,te.W,Wt.CommercialModule,Xt.S]]}),n})()}}]);