"use strict";(self.webpackChunkBemMais2=self.webpackChunkBemMais2||[]).push([[4082],{4082:(le,y,a)=>{a.r(y),a.d(y,{DepartmentsModule:()=>re});var p=a(9808),u=a(4521),T=a(7579),N=a(4128),c=a(5698),C=a(4004),x=a(2722),P=a(8746),l=a(3075),f=a(8966),M=a(801),S=a(6779),e=a(5e3),v=a(7939),E=a(2290),I=a(1299),h=a(6517),A=a(9444),R=a(6607);const U=["checkboxTree"];function O(s,r){if(1&s&&(e.TgZ(0,"option",33),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.fantasyName," ")}}function J(s,r){if(1&s&&e._UZ(0,"checkbox-tree",34,35),2&s){const t=e.oxw();e.Q6J("nodes",t.permissionNodes)}}function Y(s,r){1&s&&(e.TgZ(0,"span",36),e._uU(1,"N\xe3o existem permiss\xf5es de cargo cadastradas."),e.qZA())}function w(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"div",37)(1,"button",38),e.NdJ("click",function(){return e.CHM(t),e.oxw().closePanel()}),e._uU(2,"Cancelar"),e.qZA(),e.TgZ(3,"button",39),e._uU(4),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(4),e.hij(" ",t.isEditing?"Confirmar":"Cadastrar"," ")}}function k(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"div",37)(1,"button",38),e.NdJ("click",function(){return e.CHM(t),e.oxw().closePanel()}),e._uU(2,"Fechar"),e.qZA()()}}const F=function(){return{text:"Departamentos"}},L=function(s){return{text:s}},B=function(s,r){return[s,r]},q=function(s,r){return{"text-gray-300":s,"text-green-200":r}};let Q=(()=>{class s{constructor(t,i,n,o,m,d){this.departmentService=t,this.formBuilder=i,this.toastrService=n,this.cdRef=o,this.dialogRef=m,this.data=d,this.faChevronRight=M._tD,this.permissionNodes=[],this.selectedPermissionsNodes=[],this.selectedPermissions=[],this.destroyed$=new T.x}ngOnInit(){this.form=this.formBuilder.group({companyId:["",l.kI.required],displayName:["",l.kI.required],description:["",l.kI.required]}),this.permissionNodes=this.setTreeData(this.data.allPermissions);const t=JSON.parse(sessionStorage.getItem("bem_mais_SelectedCompany"));t&&this.form.patchValue({companyId:t}),(this.data.loggedUserPermissions.viewPermissions||this.data.loggedUserPermissions.editPermissions)&&(this.permissionNodes=this.setTreeData(this.data.allPermissions),this.data.loggedUserPermissions.editPermissions||(this.selectedPermissions=[],this.checkboxTree.disableTree())),this.data.department&&(this.isEditing=!0,this.fillForm())}ngAfterViewInit(){var t;this.checkboxTree.tree.treeModel.subscribeToState(()=>{var i,n,o,m;for(const d of Object.keys((0,S.ZN)(this.checkboxTree.tree.treeModel.selectedLeafNodeIds)))1==(0,S.ZN)(this.checkboxTree.tree.treeModel.selectedLeafNodeIds)[d]?-1==this.selectedPermissions.indexOf(null===(n=null===(i=this.checkboxTree.tree.treeModel.getNodeById(d))||void 0===i?void 0:i.data)||void 0===n?void 0:n.id)&&this.selectedPermissions.push(null===(m=null===(o=this.checkboxTree.tree.treeModel.getNodeById(d))||void 0===o?void 0:o.data)||void 0===m?void 0:m.id):this.selectedPermissions=this.selectedPermissions.filter(g=>{var D,b;return g!==(null===(b=null===(D=this.checkboxTree.tree.treeModel.getNodeById(d))||void 0===D?void 0:D.data)||void 0===b?void 0:b.id)})}),(null===(t=this.data.department)||void 0===t?void 0:t.permissions)&&(this.data.loggedUserPermissions.viewPermissions||this.data.loggedUserPermissions.editPermissions)&&this.data.department.permissions.forEach(i=>{const n=this.checkboxTree.tree.treeModel.getNodeById(i);null==n||n.setIsSelected(!0)}),(this.data.loggedUserPermissions.viewPermissions||this.data.loggedUserPermissions.editPermissions)&&(this.data.loggedUserPermissions.editPermissions||(this.checkboxTree.tree.treeModel.expandAll(),this.checkboxTree.disableTree())),this.cdRef.detectChanges()}fillForm(){var t,i,n,o;(null===(t=this.data.department)||void 0===t?void 0:t.permissions)&&(this.selectedPermissions=this.data.department.permissions),this.form.patchValue({companyId:null===(i=this.data.department)||void 0===i?void 0:i.companyId,displayName:null===(n=this.data.department)||void 0===n?void 0:n.displayName,description:null===(o=this.data.department)||void 0===o?void 0:o.description}),this.form.controls.companyId.disable(),this.data.loggedUserPermissions.editDepartment||Object.keys(this.form.controls).forEach(m=>{this.form.controls[m].disable({emitEvent:!1})})}submit(){var t;if(this.form.valid){const i=this.form.value;let n={companyId:this.isEditing?null===(t=this.data.department)||void 0===t?void 0:t.companyId:i.companyId,description:i.description,displayName:i.displayName,permissions:this.selectedPermissions};this.saveDepartment(n)}}saveDepartment(t){var i;this.isEditing?(t.id=null===(i=this.data.department)||void 0===i?void 0:i.id,this.departmentService.editDepartment(t).pipe((0,c.q)(1)).subscribe(n=>{n.id&&(sessionStorage.setItem("bem_mais_SelectedCompany",JSON.stringify(t.companyId)),this.toastrService.show("Departamento alterado com sucesso.","",{toastClass:"success-toast"}),this.dialogRef.close())},()=>{},()=>{})):this.departmentService.saveDepartment(t).pipe((0,c.q)(1)).subscribe(n=>{n.id&&(sessionStorage.setItem("bem_mais_SelectedCompany",JSON.stringify(t.companyId)),this.toastrService.show("Departamento criado com sucesso.","",{toastClass:"success-toast"}),this.dialogRef.close())},()=>{},()=>{})}setTreeData(t){return function i(n=t){return n.map(o=>({id:o.id,name:o.displayName,children:function(){var m,d;let g=[];return(null===(m=o.permissions)||void 0===m?void 0:m.length)&&(g=[...g,...i(o.permissions)]),(null===(d=o.childrenGroups)||void 0===d?void 0:d.length)&&(g=[...g,...i(o.childrenGroups)]),g}()}))}()}closePanel(){this.dialogRef.close(!1)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(v.n),e.Y36(l.qu),e.Y36(E._W),e.Y36(e.sBO),e.Y36(f.so),e.Y36(f.WI))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-department-register-dialog"]],viewQuery:function(t,i){if(1&t&&e.Gf(U,5),2&t){let n;e.iGM(n=e.CRH())&&(i.checkboxTree=n.first)}},decls:65,vars:20,consts:[[1,"wrapper","px-0"],[1,"container"],[1,"d-flex","flex-column"],[3,"isModal","items","closeModal"],[1,"card","p-5"],["id","department-register-form",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-lg-12"],[1,"d-flex","align-items-end","mb-3"],[1,"content-number","text-blue-400"],[1,"content-label"],[1,"row","mt-3"],[1,"col-lg-4"],[1,"form-group"],["formControlName","companyId",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","mt-4"],["type","text","formControlName","displayName",1,"form-control"],[1,"col-lg-8"],["rows","5","formControlName","description",1,"form-control",2,"resize","none"],[1,"col-12"],[1,"card","p-3"],[1,"d-flex","justify-content-between"],[1,"bold-txt"],["role","button","data-toggle","collapse","href","#collapseDepartmentPermissions","role","button","aria-expanded","false","aria-controls","collapseDepartmentPermissions"],[3,"ngClass"],[1,"ml-3","text-gray-500",3,"icon"],["id","collapseDepartmentPermissions",1,"collapse","permissions-card","p-3","mt-3"],["id","department-register-checkbox-tree",3,"nodes",4,"ngIf","ngIfElse"],["noPermissions",""],["class","d-flex justify-content-end",4,"ngIf","ngIfElse"],["closeOnly",""],[3,"value"],["id","department-register-checkbox-tree",3,"nodes"],["checkboxTree",""],[1,"text-gray-300"],[1,"d-flex","justify-content-end"],[1,"btn","btn-outline-light-atb",3,"click"],["type","submit","form","department-register-form",1,"btn","btn-primary-atb","ml-3"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-breadcrumb",3),e.NdJ("closeModal",function(){return i.dialogRef.close()}),e.qZA(),e.TgZ(4,"div",4)(5,"form",5),e.NdJ("ngSubmit",function(){return i.submit()}),e.TgZ(6,"div",6)(7,"div",7)(8,"div",8)(9,"span",9),e._uU(10," 1 "),e.qZA(),e.TgZ(11,"span",10),e._uU(12,"M\xfatua vinculada"),e.qZA()()()(),e.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"select",14)(17,"option",15),e._uU(18,"Selecione"),e.qZA(),e.YNc(19,O,2,2,"option",16),e.qZA()()()(),e.TgZ(20,"div",17)(21,"div",7)(22,"div",8)(23,"span",9),e._uU(24," 2 "),e.qZA(),e.TgZ(25,"span",10),e._uU(26,"Crie o nome e descri\xe7\xe3o do departamento"),e.qZA()()()(),e.TgZ(27,"div",11)(28,"div",12)(29,"div",13)(30,"label"),e._uU(31,"Nome"),e.qZA(),e._UZ(32,"input",18),e.qZA()()(),e.TgZ(33,"div",11)(34,"div",19)(35,"div",13)(36,"label"),e._uU(37,"Descri\xe7\xe3o"),e.qZA(),e._UZ(38,"textarea",20),e.qZA()()()(),e.TgZ(39,"div",17)(40,"div",7)(41,"div",8)(42,"span",9),e._uU(43," 3 "),e.qZA(),e.TgZ(44,"span",10),e._uU(45,"Selecione as permiss\xf5es"),e.qZA()()()(),e.TgZ(46,"div",11)(47,"div",21)(48,"div",22)(49,"div",23)(50,"span",24),e._uU(51,"Permiss\xf5es avan\xe7adas"),e.qZA(),e.TgZ(52,"a",25)(53,"span",26),e._uU(54),e.qZA(),e._UZ(55,"fa-icon",27),e.qZA()(),e.TgZ(56,"div",28),e.YNc(57,J,2,1,"checkbox-tree",29),e.YNc(58,Y,2,0,"ng-template",null,30,e.W1O),e.qZA()()()(),e.TgZ(60,"div",17)(61,"div",7),e.YNc(62,w,5,1,"div",31),e.YNc(63,k,3,0,"ng-template",null,32,e.W1O),e.qZA()()()()()()),2&t){const n=e.MAs(59),o=e.MAs(64);e.xp6(3),e.Q6J("isModal",!0)("items",e.WLB(14,B,e.DdM(11,F),e.VKq(12,L,i.isEditing?"Editar departamento":"Adicionar departamento"))),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(14),e.Q6J("ngForOf",i.data.companies),e.xp6(34),e.Q6J("ngClass",e.WLB(17,q,0===i.selectedPermissions.length,i.selectedPermissions.length>0)),e.xp6(1),e.Oqu(0===i.selectedPermissions.length?"Nenhuma atribu\xedda":1===i.selectedPermissions.length?"1 atribu\xedda":i.selectedPermissions.length+" atribu\xeddas"),e.xp6(1),e.Q6J("icon",i.faChevronRight),e.xp6(2),e.Q6J("ngIf",i.permissionNodes.length)("ngIfElse",n),e.xp6(5),e.Q6J("ngIf",i.data.loggedUserPermissions.editDepartment)("ngIfElse",o)}},directives:[I.L,l._Y,l.JL,l.sg,h.MU,h.HK,l.EJ,h.oH,l.JJ,l.u,l.YN,l.Kr,p.sg,l.Fj,p.mk,A.BN,p.O5,R.D],styles:[".mat-dialog-container{overflow:auto!important;padding:0}.wrapper[_ngcontent-%COMP%]{background-color:#f0f3f9;min-height:100vh;min-width:100vw;max-height:100vh;overflow-y:auto}  .cdk-overlay-pane{max-width:none!important}  .cdk-global-scrollblock{position:static;overflow:hidden!important}.container[_ngcontent-%COMP%]:first-child{padding:2rem 0}.content-number[_ngcontent-%COMP%]{color:#373a3c;font-weight:700;font-size:30px;line-height:35px}.content-label[_ngcontent-%COMP%]{font-weight:500;font-size:20px;color:#707a84;line-height:28px;margin-left:.5rem}"]}),s})();var j=a(2569),$=a(676);let Z=(()=>{class s{constructor(t,i,n,o,m,d){this.dialog=t,this.departmentService=i,this.router=n,this.route=o,this.loading=m,this.profileService=d,this.destroyed$=new T.x,this.neededPermissions={viewPermissions:"SYSTEM_VIEW_DEPARTMENT_PERMISSIONS",editPermissions:"SYSTEM_SET_DEPARTMENT_PERMISSIONS",editDepartment:"SYSTEM_EDIT_DEPARTMENT"}}ngOnInit(){this.loading.show();const t=this.route.snapshot.params.id;(0,N.D)(Object.assign(Object.assign({},t&&{department:this.departmentService.getDepartmentById(t)}),{companies:this.departmentService.getDepartmentStaticData().pipe((0,c.q)(1),(0,C.U)(i=>i.companies)),allPermissions:this.departmentService.getAllDepartmentPermissions().pipe((0,c.q)(1)),loggedUserPermissions:this.profileService.checkPermissions(this.neededPermissions).pipe((0,c.q)(1))})).pipe((0,x.R)(this.destroyed$),(0,P.x)(()=>this.loading.hide())).subscribe(i=>{this.initDialog(i)})}initDialog(t){this.dialog.open(Q,{height:"100vh",width:"100vw",maxWidth:"none",data:t,closeOnNavigation:!0,disableClose:!0}).afterClosed().pipe((0,x.R)(this.destroyed$)).subscribe(i=>{this.router.navigate(["app/administrativo/departamentos"])})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(f.uw),e.Y36(v.n),e.Y36(u.F0),e.Y36(u.gz),e.Y36(j.b),e.Y36($.i))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-department-register"]],decls:0,vars:0,template:function(t,i){},styles:[""]}),s})();var z=a(8080),W=a(1135),H=a(6367),G=a(1235),_=a(7751),V=a(5214);function K(s,r){1&s&&(e.TgZ(0,"option",22),e._uU(1,"Cooperativa"),e.qZA())}function X(s,r){if(1&s&&(e.TgZ(0,"option",23),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.fantasyName," ")}}function ee(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"div",24)(1,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().addDepartment()}),e._UZ(2,"i",26),e._uU(3," Adicionar "),e.qZA()()}}const te=function(){return["ROOT","SYSTEM_CREATE_DEPARTMENT"]};let ie=(()=>{class s extends H.K{constructor(t,i,n){super(),this.departmentService=t,this.router=i,this.route=n,this.departments$=new W.X({items:[],total:0}),this.columns=[{displayName:"Departamento",columnName:"displayName",className:"flex-30"},{displayName:"Descri\xe7\xe3o",columnName:"description"}],this.actions=[{iconClass:"fas fa-pen",eventName:"edit",tooltip:"Editar departamento",permissions:["SYSTEM_EDIT_DEPARTMENT","SYSTEM_VIEW_DEPARTMENT"]},{iconClass:"fas fa-ellipsis-v",isMenu:!0,tooltip:"Mais...",children:[{displayName:"Cargos",eventName:"roles"}]}],this.selectedCompany="",this.searchDepartments=o=>this.searchTableItem(o,this.departmentService,this.loadTable,"searchDepartments",this.departments$,"Clique em adicionar para criar um departamento","Nenhum departamento encontrado",[this.selectedCompany])}ngOnInit(){this.companies$=this.departmentService.getDepartmentStaticData().pipe((0,c.q)(1),(0,C.U)(t=>(this.spinnerTable$.next(!1),t.companies))),this.selectedCompany=JSON.parse(sessionStorage.getItem("bem_mais_SelectedCompany"))||"",this.selectedCompany&&""!==this.selectedCompany&&this.loadTable()}loadTable(t=0,i=10){this.initTable(this.departmentService,"searchDepartments","getDepartments",this.departments$,t,i,"atb-search",[this.selectedCompany])}onAction(t){switch(t.action){case"edit":this.editDepartment(t.element);break;case"lock":this.lockDepartment(t.element);break;case"roles":this.openRoles(t.element)}}openRoles(t){throw new Error("Method not implemented.")}lockDepartment(t){throw new Error("Method not implemented.")}editDepartment(t){this.router.navigate(["./",t.id],{relativeTo:this.route})}addDepartment(){this.router.navigate(["adicionar"],{relativeTo:this.route})}onCompanySelect(t){this.selectedCompany=t.target.value,sessionStorage.setItem("bem_mais_SelectedCompany",JSON.stringify(t.target.value)),""!==t.target.value?this.departmentService.getDepartments(0,10,this.selectedCompany).pipe((0,c.q)(1)).subscribe(i=>this.departments$.next(i)):this.departments$.next([])}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(v.n),e.Y36(u.F0),e.Y36(u.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-list-departments"]],features:[e.qOj],decls:28,vars:18,consts:[[1,"wrapper","px-0"],[1,"content-title"],[1,"row","mt-3"],[1,"col-lg-12"],[1,"card","p-3"],[1,"d-flex"],[1,"d-flex","align-items-center","flex-grow-1"],[1,"mb-0","regular-txt","text-gray-300","mr-3"],[1,"form-control","w-25",3,"ngModel","ngModelChange","input"],["value","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"card","py-3","px-1","mt-3","min-height"],[1,"w-100"],[1,"row","w-100","m-0"],[1,"table-header","mb-3","row","d-flex","align-items-center","justify-content-between"],[1,"col-4","col-lg-6"],["class","d-flex align-items-center",4,"ngxPermissionsOnly"],[1,"col-lg-3"],["src","../../../../../../assets/icons/search.svg","alt","",1,"search-icon"],["type","search","placeholder","Buscar","id","atb-table",1,"form-control","search-input",3,"ngbTypeahead"],["filterInput",""],["emptyClass","text-gray-600",3,"dataSource","totalItems","columns","actions","spinner","emptyMessage","onPaginator","page","action"],["value",""],[3,"value"],[1,"d-flex","align-items-center"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-plus","mr-2"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"span",1),e._uU(2,"Departamentos"),e.qZA(),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"h5",7),e._uU(9,"Selecione"),e.qZA(),e.TgZ(10,"select",8),e.NdJ("ngModelChange",function(o){return i.selectedCompany=o})("input",function(o){return i.onCompanySelect(o)}),e.YNc(11,K,2,0,"option",9),e.YNc(12,X,2,2,"option",10),e.ALo(13,"async"),e.qZA()()()()()(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"div",3)(18,"div",14)(19,"div",15),e.YNc(20,ee,4,0,"div",16),e.qZA(),e.TgZ(21,"div",17),e._UZ(22,"img",18)(23,"input",19,20),e.qZA()(),e.TgZ(25,"atb-table",21),e.NdJ("onPaginator",function(o){return i.paginator=o})("page",function(o){return i.loadTable(o.skip,o.take)})("action",function(o){return i.onAction(o)}),e.ALo(26,"async"),e.ALo(27,"async"),e.qZA()()()()()()),2&t){let n,o;e.xp6(10),e.Q6J("ngModel",i.selectedCompany),e.xp6(1),e.Q6J("ngIf",""==i.selectedCompany),e.xp6(1),e.Q6J("ngForOf",e.lcZ(13,11,i.companies$)),e.xp6(8),e.Q6J("ngxPermissionsOnly",e.DdM(17,te)),e.xp6(3),e.Q6J("ngbTypeahead",i.searchDepartments),e.xp6(2),e.Q6J("dataSource",null==(n=e.lcZ(26,13,i.departments$))?null:n.items)("totalItems",null==(o=e.lcZ(27,15,i.departments$))?null:o.total)("columns",i.columns)("actions",i.actions)("spinner",i.spinnerTable$)("emptyMessage",""==i.selectedCompany?"Selecione uma cooperativa para listar os departamentos.":"Clique em Adicionar para criar um departamento.")}},directives:[l.EJ,h.oH,l.JJ,l.On,p.O5,l.YN,l.Kr,p.sg,G.gE,_.dR,V.a],pipes:[p.Ov],styles:[""]}),s})();const se=[{path:"",component:(()=>{class s{constructor(t){this.navbarService=t,this.navbarService.setContentTitle("Painel administrativo")}ngOnInit(){}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.I))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-departments"]],decls:1,vars:0,template:function(t,i){1&t&&e._UZ(0,"app-list-departments")},directives:[ie],styles:[""]}),s})()},{path:"adicionar",component:Z,data:{title:"Adicionar departamento"}},{path:":id",component:Z,data:{title:"Editar departamento"}}];let ne=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[u.Bz.forChild(se)],u.Bz]}),s})();var oe=a(7622),ae=a(7022);let re=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[p.ez,ne,oe.m,ae.h,_.ZS]]}),s})()}}]);